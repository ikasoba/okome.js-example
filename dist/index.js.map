{
  "version": 3,
  "sources": ["../node_modules/@ikasoba000/okome.js/src/signal.ts", "../node_modules/@ikasoba000/okome.js/src/index.ts", "../src/index.jsx"],
  "sourcesContent": ["export type SignalListener<T> = (value: T, signal: Signal<T>) => void;\r\n\r\nexport class Signal<T> {\r\n  private listeners = new Set<SignalListener<T>>();\r\n  constructor(\r\n    private _value: T,\r\n    private equal = (x: T, y: T) => Object.is(x, y)\r\n  ) {}\r\n\r\n  get value() {\r\n    return this._value;\r\n  }\r\n\r\n  set value(newValue: T) {\r\n    if (this.equal(this._value, newValue)) {\r\n      return;\r\n    }\r\n    this._value = newValue;\r\n    this.listeners.forEach((f) => f(this._value, this));\r\n  }\r\n\r\n  pipe<R>(\r\n    listener: (value: T, signal: Signal<T>) => R,\r\n    equal = (x: R, y: R) => Object.is(x, y)\r\n  ): Signal<R> {\r\n    const signal = new Signal<R>(listener(this.value, this), equal);\r\n    this.onUpdate((v, s) => {\r\n      signal.value = listener(v, s);\r\n    });\r\n    return signal;\r\n  }\r\n\r\n  onUpdate(listener: SignalListener<T>) {\r\n    this.listeners.add(listener);\r\n    return this;\r\n  }\r\n\r\n  removeListener(listener: SignalListener<T>) {\r\n    return this.listeners.delete(listener);\r\n  }\r\n}\r\n", "import type { Option } from \"../types/option.js\";\r\nimport type { HooksManager } from \"./HooksManager.js\";\r\nimport { Signal } from \"./signal.js\";\r\n\r\nlet hooksManager: Option<HooksManager> = null;\r\n\r\nexport function setHooksManager(newManager?: HooksManager) {\r\n  hooksManager = newManager;\r\n}\r\n\r\nexport function getHooksManager() {\r\n  return hooksManager;\r\n}\r\n\r\nexport type StringableValue =\r\n  | string\r\n  | number\r\n  | bigint\r\n  | boolean\r\n  | object\r\n  | null\r\n  | undefined;\r\n\r\nexport type Component<A extends {} = {}> = (attrs: A) => ChildNodeType;\r\n\r\ntype RemoveStart<\r\n  R extends string,\r\n  S extends `${R}${string}`\r\n> = S extends `${R}${infer T}` ? T : never;\r\ntype ArgType<F extends (...a: any[]) => any> = F extends (...a: infer T) => any\r\n  ? T\r\n  : never;\r\n\r\nexport type GetAttrs<N extends string | Component> = N extends string\r\n  ? { [k: string]: StringableValue | Signal<any> } & {\r\n      [K in `on:${keyof HTMLElementEventMap}`]:\r\n        | ((event: HTMLElementEventMap[RemoveStart<\"on:\", K>]) => void)\r\n        | Signal<any>;\r\n    } & { children?: ChildrenNode }\r\n  : ArgType<Exclude<N, string>>[0];\r\n\r\nexport type ChildNodeType = StringableValue | Node | Signal<any>;\r\nexport type ChildrenNode = ChildNodeType[] | ChildNodeType;\r\n\r\nexport function toDOMNode<T extends ChildNodeType>(x: T): Node {\r\n  if (x instanceof Signal) {\r\n    let prevValue = toDOMNode(x.value);\r\n    let fragmentChildren =\r\n      prevValue instanceof DocumentFragment ? [...prevValue.childNodes] : [];\r\n    // \u4ECA\u306E\u30CE\u30FC\u30C9\u304C\u30D5\u30E9\u30B0\u30E1\u30F3\u30C8\u306A\u3089\u5B50\u3092fragmentChildren\u306B\u96C6\u3081\u308B\u3053\u3068\u3067\u3054\u3063\u305D\u308A\u66F8\u304D\u63DB\u3048\u3089\u308C\u308B\u3088\u3046\u306B\u3057\u3066\u3044\u308B\r\n    x.onUpdate((_value) => {\r\n      const value = toDOMNode(_value);\r\n      if (prevValue instanceof DocumentFragment) {\r\n        if (fragmentChildren.length) {\r\n          fragmentChildren[0].parentNode?.replaceChild(\r\n            value,\r\n            fragmentChildren[0]\r\n          );\r\n          fragmentChildren\r\n            .slice(1)\r\n            .forEach((x) => x.parentNode?.removeChild(x));\r\n        }\r\n        fragmentChildren = [];\r\n      } else if (value instanceof DocumentFragment) {\r\n        fragmentChildren = [...value.childNodes];\r\n        prevValue.parentNode?.replaceChild(value, prevValue);\r\n      } else {\r\n        prevValue.parentNode?.replaceChild(value, prevValue);\r\n      }\r\n      prevValue = value;\r\n    });\r\n    return prevValue;\r\n  } else if (x == null) {\r\n    return document.createComment(\"\");\r\n  }\r\n  return x instanceof Node ? x : document.createTextNode(`${x}`);\r\n}\r\n\r\nexport function createElement<N extends string | Component<any>>(\r\n  name: N,\r\n  _attrs?: GetAttrs<N>\r\n) {\r\n  hooksManager?.begin();\r\n  try {\r\n    if (typeof name != \"string\") return toDOMNode(name(_attrs));\r\n    const attrs: { children?: Node[] | Node } = {\r\n      ..._attrs,\r\n      ...{\r\n        children: _attrs?.children\r\n          ? _attrs.children instanceof Array\r\n            ? _attrs.children.map(toDOMNode)\r\n            : toDOMNode(_attrs?.children)\r\n          : undefined,\r\n      },\r\n    };\r\n    const elm = document.createElement(name);\r\n    for (let k in attrs) {\r\n      const v = attrs[k as keyof typeof attrs];\r\n      if (k == \"children\") {\r\n        if (v instanceof Array) {\r\n          elm.append(...v);\r\n        } else if (v) {\r\n          elm.append(v);\r\n        }\r\n      } else if (k.startsWith(\"on:\")) {\r\n        k = k.slice(3);\r\n        if (v instanceof Signal) {\r\n          v.onUpdate((value) => elm.addEventListener(k, value));\r\n          elm.addEventListener(k, v.value);\r\n        }\r\n        //@ts-ignore\r\n        if (v instanceof Function) elm.addEventListener(k, v);\r\n      } else if (v instanceof Signal) {\r\n        v.onUpdate((value: any) => elm.setAttribute(k, `${value}`));\r\n        elm.setAttribute(k, `${v.value}`);\r\n      } else elm.setAttribute(k, `${v}`);\r\n    }\r\n    return elm;\r\n  } finally {\r\n    const space = hooksManager?.pop();\r\n    if (space) setTimeout(() => hooksManager?.dispatch(space), 0);\r\n  }\r\n}\r\n\r\nexport const Fragment: Component<{ children: ChildrenNode }> = ({\r\n  children,\r\n}) => {\r\n  const fragment = document.createDocumentFragment();\r\n  fragment.append(\r\n    ...(children instanceof Array ? children : [children]).map(toDOMNode)\r\n  );\r\n  return fragment;\r\n};\r\n\r\nexport const jsx = createElement;\r\nexport const jsxs = createElement;\r\n\r\nexport default {\r\n  jsx,\r\n  jsxs,\r\n};\r\n", "import { toDOMNode } from \"@ikasoba000/okome.js\";\r\nimport { Signal } from \"@ikasoba000/okome.js/signal\";\r\n\r\nfunction App() {\r\n  const count = new Signal(0);\r\n\r\n  count.onUpdate(() => {\r\n    console.log(\"count:\", count.value);\r\n  });\r\n\r\n  return (\r\n    <div>\r\n      <button on:click={() => count.value++}>count: {count}</button>\r\n    </div>\r\n  );\r\n}\r\n\r\ndocument.body.append(toDOMNode(<App />));\r\n"],
  "mappings": "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",
  "names": ["Signal", "_value", "equal", "x", "y", "newValue", "f", "listener", "signal", "v", "s", "hooksManager", "toDOMNode", "x", "Signal", "prevValue", "fragmentChildren", "_value", "value", "createElement", "name", "_attrs", "hooksManager", "attrs", "elm", "k", "v", "space", "jsx", "createElement", "jsxs", "App", "count", "a", "c", "f"]
}
